Какой-то древний драматург вроде или философ (не помню какой именно) однажды сказал прекрасную фразу: "В воде ты лишь свое лицо увидишь, в вине узришь и сердце ты чужое". Вот и поговорим о прекрасном...

Ниже приведен датафрейм набора данных об оценке винных продуктов по многим странам мира. В составе данных есть несколько столбцов, описывающих тот или иной сорт вина: от оценки дегустатора до страны происхождения винограда.

Изучим более подробно эти данные и попробуем вытащить какую-то интересную информацию, постараемся разобраться в истине, которая, как известно, в вине.

[ ]
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
[ ]
from pylab import rcParams
rcParams['figure.figsize'] = 22, 15
[ ]
# сформируем и немного причешем наш датафрейм.

df = pd.read_csv("winemag.csv")
df.drop(["Unnamed: 0", "description", "designation", "region_2", "taster_twitter_handle"], axis = 1, inplace = True)
df.columns = ["production_country", "rating", "price", "province", "region", "taster_name", "title", "variety", "winery"]
df = df.drop_duplicates(keep='first') # удалим строки-дубликаты, если такие имеются

df.head()

А теперь начнем разбирательство.

Для начала посмотрим на распределение рейтинга оценки качества вина по странам. Вина чьей страны производства получили наибольший респект от дегустаторов, а чьи не обзавелись высокой оценкой.

Выделим из датафрейма два столбца (страна виноградника и рейтинг) и сгрупируем их по странам. Далее, для каждой страны найдем среднее арифметическое всех оценок и отсортируем их по возрастанию. На основе полученных данных составим горизонтальную столбчатую диаграмму для сранения рейтинга по странам производства.

[ ]
rating_country = df[["production_country","rating"]].groupby("production_country").mean()
rating_country = rating_country.sort_values(by="rating")

rating_country.head()

[ ]
# Составляем ту самую столбчатую горизонтальную диаграмму.

rating_country.plot(kind = "barh",
                    title = "Оценка винна по стране его производства",
                    xlabel = "Страна производства вина",
                    ylabel = "Рейтинг"
                    )

Из данной диаграммы мы видим, что вино английского производства считается самым качественным по мнению дегустаторов. Конечно же, и с учетом того, что разные оценки для разных сортов вина мы привели к общему среднему рейтингу, не различая их на разные.

Однако, теперь интересно изучить сорта английского вина, какие оказались более привлекательными, какие менее. Изучим, для начала, более детально райспределение рейтинга английского вина по сортам винограда.

Для этого вновь выделим из датафрейма два столбца (сорт и рейтинг), но уже только для английского вина.

[ ]
wine_england = df[df.production_country == "England"]
wine_england = wine_england[["variety","rating"]].groupby("variety")

len(wine_england) # здесь мы видим, что в данных есть информация только о 4х сортах английского вина.
wine_england.mean().head() # просто посмотрим на средний рейтинг и какие именно сорта английского вина присутствуют в датафрейме.

Сделаем диаграммы типа "ящик с усами" для сравнения рейтинговых данных для каждого отдельного сорта английского вина.

[ ]
wine = df[df.production_country == "England"]

wine_chardonnay = wine[wine.variety == "Chardonnay"]
wine_chardonnay = wine_chardonnay[["variety","rating"]].groupby("variety")
wine_pinot_noir = wine[wine.variety == "Pinot Noir"]
wine_pinot_noir = wine_pinot_noir[["variety","rating"]].groupby("variety")
wine_sparkling_blend = wine[wine.variety == "Sparkling Blend"]
wine_sparkling_blend = wine_sparkling_blend[["variety","rating"]].groupby("variety")
wine_white_blend = wine[wine.variety == "White Blend"]
wine_white_blend = wine_white_blend[["variety","rating"]].groupby("variety")

rcParams['figure.figsize'] = 5, 5

wine_chardonnay.plot(kind = "box", title = "Сорт Chardonnay")
wine_pinot_noir.plot(kind = "box", title = "Сорт Pinot Noir")
wine_sparkling_blend.plot(kind = "box", title = "Сорт Sparkling Blend")
wine_white_blend.plot(kind = "box", title = "Сорт White Blend")

# хотел для удобства и наглядности сделать все в общей системе координат, но за несколько часов так и не разобрался как это сделать...

Из графиков видно, что в целом большей популярностью пользуется вино сорта Шардоне английского производства. Медиана, размахи и прочие меры располагаются выше, чем меры любого другого сорта вина.

При этом про вино сорта White Blend вообще вряд ли что-то можно сказать, так как упоминание об этом сорте вина английского производства встречается лишь один раз (указано ниже).

[ ]
df_white_blend = df[df.variety == "White Blend"]
df_white_blend = df_white_blend[df_white_blend.production_country == "England"]
df_white_blend.head()

Посмотрим рейтинговые оценки для данного сорта вина (White Blend) вне зависимости от страны производителя и попробуем сделать хоть какие-то выводы для него.

[ ]
# выделим отдельный датафрейм только для данного сорта вина по разным странам и для наглядности покажем средний рейтинг по каждой стране.
df_white_blend = df[df.variety == "White Blend"]
df_white_blend = df_white_blend[["production_country","rating"]].groupby("production_country").mean()
df_white_blend = df_white_blend.sort_values(by="rating")
df_white_blend.head()

Теперь сделаем график "коробка с усами" и для наглядности сравним его с самым популярным вином английского производства сорта Шардоне.

Ну и для наглядности добавим такой же график для мировой оценки вина сорта Шардоне.

[ ]
df_white_blend = df[df.variety == "White Blend"]
df_white_blend = df[["production_country","rating"]]

df_сhardonnay = df[df.variety == "Chardonnay"]
df_сhardonnay = df[["production_country","rating"]]

df_white_blend.plot(kind = "box", title = " Сорт White Blend_world")
wine_chardonnay.plot(kind = "box", title = "Сорт Chardonnay_England")
df_сhardonnay.plot(kind = "box", title = "Сорт Chardonnay_world")

# все еще не разобрался как поместить все на одно простраство.

Видно, что даже если взять общемировой рейтинг по сортам вина, White Blend и Шардоне примерно одинаковые по всем своим мерам. Однако английский Шардоне ценят больше, чем какой-либо еще Шардоне. Рейтинг английского вина лидирует по всем показателям, а Шардоне лидирует в списке английских вин. Однако про английский сорт White Blend вообще ничего сказать нельзя по одной лишь оценке. И как понимать рейтинг английского White Blend мне не особо понятно, из-за чего трудно что-то сказать о том, что английское Шардоне по мнению критиков можно считать самым хорошим вином из всех тех, что были продегустированы.

И все же вернемся к Шардоне как к самому оцененному в Королевстве. Посмотрим вообще связаны рейтинг данного сорта вина и его стоимость, раз уж по оценкам дегустаторов оно такое вкусное и хорошее. Есть ли там какая-либо зависимость или закономерость. Для этого используем точечную диаграмму.

[ ]
# выделим только вино сорта Шардоне и оставим столбцы рейтинга и стоимости вина.
price_rating = df[df.variety == "Chardonnay"]
price_rating[["rating", "price"]].head()

[ ]
rcParams['figure.figsize'] = 11, 11

price_rating.plot.scatter(x = "rating",
                          y = "price",
                          title = "Зависимость стоимости вина от рейтинга дегустации")

На графике мы видим явную зависимость "выше рейтинг - дороже вино". Не понятно, говорит ли это о том, что более дорогее вино вкуснее. Возможно это происходит просто из-за шаблона "дорогое- значит качественное". Хотя, дегустаторам могут и не сообщить о стоимости во время дегустации.

Так же из графика виден аномальный выброс. Одно "явно недооцененное Шардоне" ценой примерно в 2000 единиц и достаточно средним рейтингом. Но в целом виден вполне понятный закон.

Про сорта поговорили, теперь поговорим про объективность критиков. Посмотрим кто, сколько и каких больше всего оценкок ставил, пробуя те или иные вина.

Для начала посмотрим каких оценок вообще ставили больше всего. Заведем гистограмму, где посмотрим распределение рейтинга.

[ ]
hist_rating = df.rating

hist_rating.plot(kind = "hist",
                 bins = 21,
                 title = "Гистограмма распределения рейтинговых оценок",
                 xlabel = "rating"
                 )

[ ]
print("Мода:", int(hist_rating.mode()))
print("Медиана:", int(hist_rating.median()))
print("Среднее арифметическое:", float(hist_rating.mean()))

print("Длина датафрейма:", df.shape[0])
Мода: 88
Медиана: 88
Среднее арифметическое: 88.4421684737281
Длина датафрейма: 119900
Из гистограммы видно, что распределение очень похоже на нормальное с центром в точке 88, что подтверждают мода, медиана и среднее значение. Около 15000 значений, что составляет около 13% от всех значений. Достаточно неплохие оценки, если учесть то, что система стобальная. К тому же явно видно, что нет оценок ниже 80 баллов.

Так как критиков у нас не так уж и много (20, как показано ниже), то можно составить таблицу базовых статистик для каждого из пользователей. Составим данную таблицу по оценкам критиков.

[ ]
# количество дегустаторов
len(df.taster_name.unique())
20
[ ]
#создаем датафрейм базовых статистик по оценкам критиков.

tasters_mean = df[["taster_name","rating"]].groupby("taster_name").mean()
tasters_min = df[["taster_name","rating"]].groupby("taster_name").min()
tasters_max = df[["taster_name","rating"]].groupby("taster_name").max()
tasters_median = df[["taster_name","rating"]].groupby("taster_name").median()
tasters_quantile_1 = df[["taster_name","rating"]].groupby("taster_name").quantile([0.25])
tasters_mode = df[["taster_name","rating"]].groupby("taster_name").quantile([0.50])
tasters_quantile_3 = df[["taster_name","rating"]].groupby("taster_name").quantile([0.75])

tasters = tasters_mean.merge(tasters_min, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters = tasters.merge(tasters_max, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters = tasters.merge(tasters_median, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters = tasters.merge(tasters_mode, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters = tasters.merge(tasters_quantile_1, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters = tasters.merge(tasters_quantile_3, left_on = "taster_name", right_on = "taster_name", how = "outer")
tasters.columns = ["mean", "max", "min", "median", "mode", "q1", "q3"]
tasters

Так как мы выяснили, что распределение оценок можно считать нормальным, и меры центральной тенденции для такого распределения находятся максимально близко друг к другу (что и происходит на практике, все значения колеблятся совсем близко к значению 88), то создадим похожий датафрейм, оставив в нем лишь столбы taster_name, mean, mode и median. Эти значения практически равно друг другу при нормальном распределении, а значит, оставив только их, мы можем составить тепловую карту, из которой можно будет увидеть некоторое распределение оценок по каждому отдельному критику (кто обычно ставит оценки ниже, кто выше, у кого какой размах и прочее).

Но для начала создадим диаграмму "коробка с усами", чтобы просто визаульно посмотреть на разброс рейтинговых оценок.

[ ]
df_ratings = df["rating"]

rcParams['figure.figsize'] = 10, 10

df_ratings.plot(kind = "box", title = "Распределение рейтинга оценки качества вина")

[ ]
tasters_heat_map = tasters[["mean", "median", "mode"]]
tasters_heat_map

[ ]
sns.heatmap(tasters_heat_map,
            annot=True
            )


Из полученой тепловой карты видно, что критик Alexander Peartree очевидно самый строгий и недовольный своей профессией и жизненным раскладом. Средние показатели его оценок ниже, чем у кого-либо еще. Трудно утверждать, что все его оценки исключительно низкие, нужны дополнительные исследования. Однако пропущенных значений в столбце rating нет (как доказано ниже), а значит можно утвержать, что данный дегустатор скуп на похвальные отзывы относительно других критиков.

А вот дегустатор Anne Krebiehl MW, видимо, нашла себя в этой сложной специальности дегустатора вина, и очевидно менее прихотлива в выборе горячительных напитков. Все ее центральные меры находятся выше, чем у остальных дегустатоторов с аномально высоким средним величиной в 91 балл из 100 возможных. Явно лучший работник месяца. Она заслужила отдых, оставим ее.

[ ]
# пропущенные значения в столбец rating
len(df[df.rating == np.nan].isnull().sum(axis=1))
0
Дегустатор Alexander Peartree очень загадочный персонаж, и хотелось бы немного выяснить кто он такой. И не смотря на то, что он очень строгий, все же хотелось бы выяснить какой сорт вина понравился ему больше всего.

[ ]
df_alexander_peartreel = df[df.taster_name == "Alexander Peartree"]
print("Количество оценок критика:", len(df_alexander_peartreel))

count_alexander_peartreel = df_alexander_peartreel[["variety","rating"]].groupby("variety").mean()
count_alexander_peartreel = count_alexander_peartreel.sort_values(by="rating")
print("Количество оцененных сортов вина:", len(count_alexander_peartreel))

count_alexander_peartreel.head()

Мы видим, что данный дегустатор оставил 383 отзыва на 62 сорта вина, чего более менее достаточно для того, чтобы понять его предпочтения.

Для этого заведем столбчатую диаграмму по сортам вина и его оценкам каждого из них.

[ ]
rcParams['figure.figsize'] = 18, 18

count_alexander_peartreel.plot(kind = "barh",
                    title = "Оценка винна по сортам дегустатора Alexander Peartree",
                    xlabel = "Сорт вина",
                    ylabel = "Выставленный рейтинг"
                    )

Из столбчатой диаграммы видно, Alexander Peartree очень полюбил вино сорта Таурига и совершенно не оценил сорт Rkatsiteli.

В завершении можно заключить следующее:

Вино английского происхождения получило большую любовь у дегустаторов.
Английское вино сорта Шардоне, возможно, имеет наилучшие оценки среди всех прочих вин разных стран произзводства. Однако, не хватает информации о рейтинге сорте вина White Blend, чтобы утверждать что-то точно.
В среднем, оценки критиков более-менее адекватные и поддаются нормальному закону распределения с центром в точке 88. Оценок ниже 80 нет вообще. Рейтинг распределен без сильных перекосов в ту или иную сторону и не имеет большого количества выбросов.
